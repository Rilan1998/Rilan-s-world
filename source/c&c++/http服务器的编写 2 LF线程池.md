http服务器的编写 2 LF线程池.md
======================================
一，线程池模式介绍
线程池模式一般分为两种：L/F领导者与跟随者模式、HS/HA半同步/半异步模式。
HS/HA
半同步/半异步模式：分为三层，
同步层、队列层、异步层，又称为生产者消费者模式，主线程处理I/O事件并解析然后再往队列丢数据，然后消费者读出数据进行应用逻辑处理；
优点：简化编程将低层的异步I/O和高层同步应用服务分离，且没有降低低层服务性能。集中层间通信。
缺点：需要线程间传输数据，因此而带来的动态内存分配，数据拷贝，语境切换带来开销。高层服务不可能从底层异步服务效率中获益。

L/F
领导者/跟随者模式：
在LF线程池中，线程可处在3种线程状态之一：leader、follower或processor。
处于leader状态的线程负责监听网络端口，当有消息到达时，该线程负责消息分离，并从处于follower状态中的线程中按照某种机制如FIFO或基于优先级等选出一个来当新的leader，然后将自己设置为processor状态去分配和处理该事件。处理完毕后线程将自身的状态设置为follower状态去等待重新成为leader。在整个线程池中同一时刻只有一个线程可以处于leader状态，这保证了同一事件不会被多个线程重复处理。
缺点：实现复杂性和缺乏灵活性；
优点：增强了CPU高速缓存相似性，消除了动态内存分配和线程间的数据交换。


二，L/F线程池实现


